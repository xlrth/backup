#include "CTime.h"

#include "Helpers.h"

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
CTime::CTime(long long value)
    :
    mValue(value)
{}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
CTime::CTime(std::chrono::system_clock::time_point value)
    :
    mValue(SystemTimePointToLongLong(value))
{}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
CTime::CTime(std::chrono::file_clock::time_point value)
    :
    mValue(SystemTimePointToLongLong(Helpers::FileTimeToSystemTime(value)))
{}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
bool CTime::IsSpecified() const
{
    return mValue != UNSPECIFIED;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
CTime::operator std::chrono::system_clock::time_point() const
{
    return LongLongToSystemTimePoint(mValue);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
CTime::operator std::chrono::file_clock::time_point() const
{
    return Helpers::SystemTimeToFileTime(LongLongToSystemTimePoint(mValue));
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
CTime::operator long long() const
{
    return mValue;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
long long CTime::SystemTimePointToLongLong(std::chrono::system_clock::time_point timePoint)
{
    return timePoint.time_since_epoch().count();
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
std::chrono::system_clock::time_point CTime::LongLongToSystemTimePoint(long long longLong)
{
    return std::chrono::system_clock::time_point(std::chrono::system_clock::duration(longLong));
}
